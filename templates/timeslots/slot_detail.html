{% extends "base.html" %}
{% load timeslots_filters i18n crispy_forms_tags %}

{% block extra_head %}
    <script type="text/javascript">
        $(function() {
            $('.charge_detail').formset({
                prefix: '{{ form.prefix }}',
                addText: '<button class="btn btn-mini" name="addCharge"><i class="icon-plus-sign"></i> {% trans "add another charge" %}</button>',
                deleteText: '<i class="icon-remove-circle" style="display: block;" title="{% trans "Delete Job" %}"></i>',
            });
        })
        function preventUnload( state ) {
            unloadMessage = "Wenn Sie die Seite verlassen, wird dieser Slot f√ºr Sie reserviert!";
            window.onbeforeunload = state ? function() { return unloadMessage; } : null;
        }
        preventUnload( true );	
        {% if created %}
        setTimeout(function() { $('#timeout-warning').slideDown('slow') }, 150000);
        setTimeout(function() { $('#timeout-warning').slideUp('slow'); $('#timeout-alert').delay(800).slideDown('slow') }, 300000);
        {% endif %}
    </script>
{% endblock %}

{% block sidebar %}{% endblock %}

{% block content %}
<div class="page-header"><h1>{% trans "Reservation for" %} {{ date|nice_date }}</h1></div> 
<div id="timeout-warning" class="alert alert-warning">
    <strong>{% trans "Warning: " %}</strong><br /> 
    {% trans "Your reservation for this slot will end soon! Please fill in the form and send it." %}
</div>
<div id="timeout-alert" class="alert alert-error">
    <strong>{% trans "Error: " %}</strong><br /> 
    {% trans "Your reservation for this slot has enden! It is not sure, whether any changes can be saved." %}
</div>

<div class="well">
    <div class="section">
        <table class="table table-bordered data-details">
            <tr>
                <td class="small-column"><strong>{% trans "Time" %}</strong></th>
                <td>{{ times }}</td>
                <td class="small-column"><strong>{% trans "Company" %}</strong></th>
                <td>{% firstof slot.user.userprofile.company user.userprofile.company %}</td>
            </tr>
            <tr>
                <td><strong>{% trans "Station" %}</strong></th>
                <td>{{ station }}</td>
                <td><strong>{% trans "User" %}</strong></th>
                <td>{% firstof slot.user.get_full_name slot.user.username user.get_full_name user.username %}</td>
            </tr>
            <tr>
                <td><strong>{% trans "Dock" %}</strong></th>
                <td>{{ curr_block.dock.name }}</td>
                <td><strong>Vom</strong></td>
                <td><{{ slot.created }}/td>
            </tr>
        </table>
    </div>

    <div class="section">
        <h2>{% trans "Corresponding jobs" %}</h2>
        {% if form.non_form_errors %}
        <div class="alert alert-error">
            <strong>{% trans "Error: " %}</strong>
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <br />{{ form.non_form_errors }}
        </div>
        {% endif %}
        <form action="." method="post" class="form-horizontal">{% csrf_token %}
            <table class="table table-bordered table-striped">
                <thead><tr><th>{% trans "Jobnumber" %}</th><th>{% trans "Description" %}</th><th></th></tr></thead>
                <tbody>
                {% for f in form %}
                    <tr {% if not station.id == 2 %}class="charge_detail"{% endif %}>
                        <td>{{ f.id }}{{ f.number|as_crispy_field }}</td>
                        <td>{{ f.description|as_crispy_field }}</td>
                        <td>{% if f.instance.pk %}{{ f.DELETE }}{% endif %}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {{ form.management_form }}

            <div class="buttons">
                <button type="submit" class="btn btn-success" name="makeReservation" onclick="preventUnload(false)">
                    {% if created %}{% trans "Make reservation" %}{% else %}{% trans "Update reservation" %}{% endif %}
                </button>
                <button type="submit" class="btn btn-warning" name="cancelReservation" onclick="preventUnload(false)">
                    {% if created %}{% trans "Cancel reservation" %}{% else %}{% trans "Delete reservation" %}{% endif %}
                </button>
                <button type="reset" class="btn">{% trans "Reset form" %}</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
